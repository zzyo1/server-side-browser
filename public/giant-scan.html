<!DOCTYPE html>
<html>
<head>
    <title>WebRTC IP Address Example</title>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            // RTCPeerConnection을 생성합니다.
            var peerConnection = new RTCPeerConnection({
                iceServers: [{urls: "stun:stun4.l.google.com:19302"}]
            });

            // ICE candidate(후보)를 수집합니다.
            peerConnection.onicecandidate = function(event) {
                console.log("Candidate available:", event.candidate);
                if (event.candidate) {
                    // IP 주소 추출 로직
                    var ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                    var match = ipRegex.exec(event.candidate.candidate);
                    if (match) {
                        var ipAddr = match[1];
                        console.log('Your IP Address:', ipAddr);
                    }
                } else {
                    // 모든 ICE 후보자 수집이 완료되었습니다.
                    console.log('ICE Candidate collection finished.');
                    peerConnection.close();
                }
            };

            // 빈 SDP offer를 생성하여 ICE candidate 수집을 시작합니다.
            peerConnection.createOffer().then(function(sdp) {
                peerConnection.setLocalDescription(sdp).then(() => {
                    console.log('Local description set successfully.');
                }).catch(function(error) {
                    console.error('Error setting local description:', error);
                });
            }).catch(function(error) {
                console.error('Error creating offer:', error);
            });
        });
    </script>
</body>
</html>
